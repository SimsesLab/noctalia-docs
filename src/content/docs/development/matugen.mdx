---
title: Create a Matugen template
description: This guide walks you through adding a new Matugen template to Noctalia.
sidebar:
  order: 3
---

This guide walks you through adding a new **Matugen** template to **Noctalia**.

---

## Overview

Adding a new template is straightforward once you know the flow.  
You'll go through five steps:

1. [Create the template file](#step-1-create-the-template-file)  
2. [Add a settings toggle](#step-2-add-a-settings-toggle)  
3. [Wire the template into the config generator](#step-3-wire-it-into-the-config-generator)  
4. [Show the toggle only if the program exists](#step-4-show-the-toggle-only-if-the-program-exists)  
5. [Add the UI toggle](#step-5-add-the-ui-toggle)

Let's break it down step by step.

---

## Step 1: Create the Template File

First, create your template file in the Matugen templates directory.  
For example, if you're making one for kitty, create:

**`Assets/MatugenTemplates/kitty.conf`**

```yaml
# Generated by Matugen via Noctalia
color0 {{colors.surface.default.hex}}
color1 {{colors.error.default.hex}}
color2 {{colors.tertiary.default.hex}}
color3 {{colors.secondary.default.hex}}
color4 {{colors.primary.default.hex}}
color5 {{colors.primary.default.hex}}
color6 {{colors.secondary.default.hex}}
color7 {{colors.on_background.default.hex}}
color8 {{colors.outline.default.hex}}
color9 {{colors.secondary_fixed_dim.default.hex}}
color10 {{colors.tertiary_container.default.hex}}
color11 {{colors.surface_container.default.hex}}
color12 {{colors.primary_container.default.hex}}
color13 {{colors.on_primary_container.default.hex}}
color14 {{colors.surface_variant.default.hex}}
color15 {{colors.on_background.default.hex}}

cursor {{colors.primary.default.hex}}
cursor_text_color {{colors.on_surface.default.hex}}

foreground            {{colors.on_surface.default.hex}}
background            {{colors.surface.default.hex}}
selection_foreground  {{colors.on_secondary.default.hex}}
selection_background  {{colors.secondary_fixed_dim.default.hex}}
url_color             {{colors.primary.default.hex}}
```

Matugen uses template variables to map Material Design 3 colors to different app formats.  
You can find all the available variables and their Material 3 mappings in the [Matugen wiki](https://github.com/InioX/matugen/wiki).

---

## Step 2: Add a Settings Toggle

Next, create a setting to control whether this template is generated.  
Open **`Commons/Settings.qml`**, find the `templates` JsonObject, and add a new property:

```qml
property JsonObject templates: JsonObject {
    // ... existing properties ...
    property bool kitty: false
}
```

This adds a persistent toggle that defaults to `false`.

---

## Step 3: Wire It Into the Config Generator

Now tell the system when to use the new template.  
Open **`Services/AppThemeService.qml`** and find the `predefinedTemplateConfigs` object.  
Add your template config alongside the existing ones:

```qml
"kitty": {
  "input": "kitty.conf",
  "outputs": [{
      "path": "~/.config/kitty/themes/noctalia.conf"
    }],
  "postProcess": () => `${colorsApplyScript} kitty\n`
}
```

The `postProcess` function tells the system to run a script after generating the colors, which is useful for reloading the application's theme.

---

## Step 4: Show the Toggle Only if the Program Exists

We don't want to display the toggle if kitty isn't installed.  
Open **`Services/ProgramCheckerService.qml`** and:

1. Add a property to track availability:

```qml
property bool kittyAvailable: false
```

2. Add an entry to the `programsToCheck` object:

```qml
programsToCheck: {
    // ... existing entries ...
    "kittyAvailable": ["which", "kitty"],
}
```

This automatically updates `kittyAvailable` when the program is detected.

---

## Step 5: Add the UI Toggle

Finally, add the toggle to the settings panel.  
Open **`Modules/SettingsPanel/Tabs/ColorSchemeTab.qml`**, find the appropriate section (or create one), and insert:

```qml
NCheckbox {
    label: "kitty"
    description: ProgramCheckerService.kittyAvailable
        ? "Write ~/.config/kitty/themes/noctalia.conf and reload"
        : "Requires kitty to be installed"
    checked: Settings.data.templates.kitty
    enabled: ProgramCheckerService.kittyAvailable
    opacity: ProgramCheckerService.kittyAvailable ? 1.0 : 0.6
    onToggled: checked => {
        if (ProgramCheckerService.kittyAvailable) {
            Settings.data.templates.kitty = checked
            if (Settings.data.colorSchemes.useWallpaperColors)
                AppThemeService.generateFromWallpaper()
            else if (Settings.data.colorSchemes.generateTemplatesForPredefined)
                AppThemeService.generateFromPredefinedScheme(ColorSchemeService.getCurrentScheme())
        }
    }
}
```

This checkbox:  
- Shows a helpful description based on whether kitty is installed  
- Disables itself automatically if the program isn't available  
- Regenerates colors right away when toggled (for both wallpaper and predefined schemes)

---

## How Color Generation Works

Noctalia supports two different color generation modes:

### Wallpaper-Based Colors
When `Settings.data.colorSchemes.useWallpaperColors` is enabled, the system uses Matugen to analyze the current wallpaper and generates a complete Material Design 3 color palette. This palette is then used to generate all enabled templates using the standard Matugen workflow.

### Predefined Color Schemes
When wallpaper colors are disabled, Noctalia uses predefined color schemes (like Nord, Dracula, Catppuccin, etc.). For these schemes, the system:

1. **Generates a Material Design 3 palette** - Uses `ColorsConvert.js` helper functions to create a complete Material Design 3 color palette from the predefined scheme's key colors
2. **Maps predefined colors intelligently** - Primary, secondary, tertiary, error, and surface colors from the predefined scheme are used as the foundation
3. **Generates complementary colors** - Container colors, "on" colors (for text/icons), surface variants, and outline colors are generated using color theory algorithms
4. **Processes templates directly** - Templates are copied and color placeholders are replaced with the generated Material Design 3 colors using `sed`

This approach ensures that predefined color schemes maintain their authentic look while providing a complete Material Design 3 palette for consistent theming across all applications.

:::info[**Terminal Templates**]
Terminal templates are handled specially - they use predefined color schemes directly for better contrast and readability rather than the generated Material Design 3 palette. This ensures terminal applications have optimal readability with high contrast colors.
:::

---

:::tip[Organizing Templates]
If there's no obvious category for your template, don't hesitate to create a new collapsible section.  
For miscellaneous apps, you can drop them into a "Misc" category.
:::

---

## Template Development Tips

### Testing Your Template
1. Enable your template in the settings
2. Switch between different predefined color schemes to ensure your template works with all of them
3. Test with both wallpaper-based and predefined color schemes
4. Verify that the generated files are placed in the correct locations

### Common Issues
- **Path expansion**: Make sure to use `~` in output paths as the system handles tilde expansion
- **Color mapping**: Ensure your template uses the correct Material Design 3 color tokens
- **File permissions**: Some applications may require specific file permissions or locations
